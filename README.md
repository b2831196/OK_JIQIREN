# 交易对格式规范化更新

## 主要问题

系统中存在两种交易对格式：
1. 基础格式：如 `BTC-USDT`
2. 合约格式：如 `BTC-USDT-SWAP`

这导致了以下问题：
- 同一个交易对可能以两种不同格式存储在 `trading_pairs.json` 中
- 删除一种格式的交易对后，另一种格式仍然存在
- 显示和处理交易对时出现不一致

## 解决方案

我们对系统进行了以下修改：

1. **统一交易对格式**：
   - 所有存储的交易对统一使用合约格式（`BTC-USDT-SWAP`）
   - 在前端显示时可以使用友好格式（`BTC/USDT`）

2. **修改 `trading_pairs.py`**：
   - 修改 `add_trading_pair` 函数，确保存储的交易对始终为 SWAP 格式
   - 修改 `remove_trading_pair` 函数，同时删除基础格式和合约格式的交易对
   - 修改 `get_trading_pair` 函数，支持查询两种格式但始终返回 SWAP 格式的结果

3. **修改 `app.py`**：
   - 在 `save_strategy` 函数中添加交易对规范化逻辑
   - 在调用 `dingdan_for` 和 `xiadan_Order_System` 前确保使用规范化的交易对
   - 保留原始交易对用于记录和调试，但统一使用规范化后的交易对与系统交互

4. **提供清理工具**：
   - 创建 `clean_trading_pairs.py` 脚本，用于清理现有 `trading_pairs.json`
   - 将所有非 SWAP 格式的交易对转换为 SWAP 格式
   - 处理可能存在的重复交易对

## 如何使用

1. **运行清理工具**：
   ```
   python clean_trading_pairs.py
   ```
   这将清理现有的 `trading_pairs.json` 文件，将所有交易对规范化为 SWAP 格式。

2. **使用规范化的代码**：
   - 系统将自动处理交易对格式
   - 不再需要手动处理 SWAP 后缀

## 特殊币种处理

对于 ARB 等特殊币种，系统会:
1. 在交易和显示时做特殊标记
2. 提示用户合约数量可能代表代币数量而非合约张数
3. 提供更清晰的持仓信息展示

## 注意事项

1. 删除交易对时，两种格式都会被同时删除
2. 在代码中添加了详细的日志，便于调试和跟踪
3. 始终保存备份以防数据丢失 